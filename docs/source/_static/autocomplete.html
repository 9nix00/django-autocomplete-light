<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>autocomplete.js</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>autocomplete.js</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>Here is the list of the major difference with other autocomplete scripts:</p>
<ul>
<li>don't do anything but fire a signal when a choice is selected: it's
left as an exercise to the developer to implement whatever he wants when
that happens</li>
<li>don't generate the autocomplete HTML, it should be generated by the server</li>
</ul>
<p>Let's establish the vocabulary used in this script, so that we speak the
same language:</p>
<ul>
<li>The text input element is "input",</li>
<li>The default text in the input is "placeholder",</li>
<li>The box that contains a list of choices is "autocomplete",</li>
<li>Each result in the "autocomplete" is a "choice",</li>
<li>With a capital A, "Autocomplete", is the class or an instance of the
class.</li>
</ul>
<p>Here is a fantastic schema in ASCII art:</p>
<pre><code>+---------------------+ &lt;----- Input
| Your city name ? &lt;---------- Placeholder
+---------------------+
| Paris, France       | &lt;----- Autocomplete
| Paris, TX, USA      |
| Paris, TN, USA      |
| Paris, KY, USA &lt;------------ Choice
| Paris, IL, USA      |
+---------------------+
</code></pre>
<p>This script defines three signals:</p>
<ul>
<li>hilightChoice: when a choice is hilight, or that the user
navigates into a choice with the keyboard,</li>
<li>dehilightChoice: when a choice was hilighed, and that the user
navigates into another choice with the keyboard or mouse,</li>
<li>selectChoice: when the user clicks on a choice, or that he pressed
enter on a hilighted choice.</li>
</ul>
<p>They all work the same, here's a trivial example:</p>
<p>$('#your-autocomplete').bind(
      'selectChoice',
      function(e, choice, autocomplete) {
          alert('You selected: ' + choice.html());
      }
  );</p>
<p>Note that 'e' is the variable containing the event object.</p>
<p>Also, note that this script is composed of two main parts:</p>
<ul>
<li>The Autocomplete class that handles all interaction, defined as
<code>Autocomplete</code>,</li>
<li>The jQuery plugin that manages Autocomplete instance, defined as
<code>$.fn.yourlabsAutocomplete</code></li>
</ul>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Our class will live in the yourlabs global namespace.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">yourlabs</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">yourlabs</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>The autocomplete class constructor:</p>
<ul>
<li>takes a takes a text input element as argument,</li>
<li>sets attributes and methods for this instance.</li>
</ul>
<p>The reason you want to learn about all this script is that you will then be
able to override any variable or function in it on a case-per-case basis.
However, overriding is the job of the jQuery plugin so the procedure is
described there.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">yourlabs</span><span class="p">.</span><span class="nx">Autocomplete</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Each autocomplete instance should have a unique identifier, so that the
jQuery plugin can keep a registry of instances, but also to compose some
unique attributes for the generated autocomplete.</p>
<p>By default, assume that the input has a unique id attribute that can be
re-used. Otherwise, the jQuery plugin will yell.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>The text input element that should have an autocomplete. It should have
a unique id attribute, or you'd have to override this.id as described
above.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">input</span> <span class="o">=</span> <span class="nx">input</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>The value of the input. It is kept as an attribute for optimisation
purposes.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>When the input is empty, show this text.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">placeholder</span> <span class="o">=</span> <span class="s1">&#39;type your search here&#39;</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>It is possible to wait until a certain number of characters have been
typed in the input before making a request to the server, to limit the
number of requests.</p>
<p>However, you may want the autocomplete to behave like a select. If you
want that a simple click shows the autocomplete, set this to 0.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">minimumCharacters</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>The autocomplete should be above any other element in the page. If your
autocomplete is hidden by another element, overriding this attribute
could fix it.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">autocompleteZIndex</span> <span class="o">=</span> <span class="mi">999999</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>The autocomplete HTML. Because of CSS limitations, it is wrapped in 3
divs, the outermost being the 'outer container' and the innermost the
'inner container'.</p>
<p>The server-side generate autocomplete HTML will be set in the inner
container.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">autocompleteContainerHtml</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;&lt;div id=&quot;id-&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;class=&quot;yourlabs-autocomplete outer-container id-&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;style=&quot;display:none; position:absolute;z-index:&#39;</span><span class="p">,</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">autocompleteZIndex</span><span class="o">+</span><span class="s1">&#39;;&quot;&gt;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;   &lt;div class=&quot;yourlabs-autocomplete id-&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;&lt;div class=&quot;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;yourlabs-autocomplete inner-container  id-&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
                <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;style=&quot;display:none;&quot;&gt;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
    <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>The autocomplete is placed in position:absolute. Thus, it doesn't really
matter where this script appends the autocomplete container.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">appendAutocompleteTo</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>In a perfect world, we would hide the autocomplete when the input looses
focus (on blur). But in reality, if the user clicks on a choice, the
input looses focus, and that would hide the autocomplete, <em>before</em> we
can intercept the click on the choice.</p>
<p>When the input looses focus, wait for this number of milliseconds before
hiding the autocomplete.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">hideAfter</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>The server should have a URL that takes the input value, and responds
with the list of choices as HTML. In most cases, an absolute URL is
better.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>As the server responds with plain HTML, we need a selector to find the
choices that it contains.</p>
<p>For example, if the URL returns an HTML body where every result is in a
div of class "choice", then this should be set to '.choice'.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">choiceSelector</span> <span class="o">=</span> <span class="s1">&#39;.choice&#39;</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>When the user hovers a choice, it is nice to hilight it, for
example by changing it's background color. That's the job of CSS code.</p>
<p>However, the CSS can not depend on the :hover because the user can
hilight choices with the keyboard by pressing the up and down
keys.</p>
<p>To counter that problem, we specify a particular class that will be set
on a choice when it's 'hilighted', and unset when it's
'dehilighted'.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">hilightClass</span> <span class="o">=</span> <span class="s1">&#39;hilight&#39;</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>The value of the input is passed to the server via a GET variable. This
is the name of the variable.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">queryVariable</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>This dict will also be passed to the server as GET variables.</p>
<p>If this autocomplete depends on another user defined value, then the
other user defined value should be set in this dict.</p>
<p>Consider a country select and a city autocomplete. The city autocomplete
should only fetch city choices that are in the selected country. To
achieve this, update the data with the value of the country select:</p>
<pre><code>$('select[name=country]').change(function() {
    $('city[name=country]').yourlabsAutocomplete().data = {
        country: $(this).val(),
    }
});
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>To avoid several requests to be pending at the same time, the current
request is aborted before a new one is sent. This attribute will hold the
current XMLHttpRequest.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">xhr</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>Rather than directly setting up the autocomplete (DOM events etc ...) in
the constructor, setup is done in this method. This allows to:</p>
<ul>
<li>instanciate an Autocomplete,</li>
<li>override attribute/methods of the instance,</li>
<li>and <em>then</em> setup the instance.</li>
</ul>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">initialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Selector for choices of this autocomplete.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">autocompleteChoiceSelector</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;.yourlabs-autocomplete.inner-container.id-&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">choiceSelector</span><span class="p">,</span>
        <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>Selector for hilighted choices of this autocomplete.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">hilightedChoiceSelector</span> <span class="o">=</span> <span class="p">[</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">autocompleteChoiceSelector</span><span class="p">,</span>
            <span class="s1">&#39;.&#39;</span><span class="p">,</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">hilightClass</span><span class="p">,</span>
        <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>'this' is going to be out of scope some times, so we reference it in
a local variable.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">autocomplete</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Append the container HTML somewhere so that it exists in the DOM.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">autocompleteContainerHtml</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">appendAutocompleteTo</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>Cache the references to the container elements for performance.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">innerContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.yourlabs-autocomplete.inner-container.id-&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">outerContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.yourlabs-autocomplete.outer-container.id-&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>Set the initial input value using the placeholder string.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">placeholder</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">live</span><span class="p">({</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>Empty the input if it contains the placeholder string so that
the user can type his stuff.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="nx">focus</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">placeholder</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nx">blur</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>Put the placeholder back in the input when the user leaves the
input empty.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">autocomplete</span><span class="p">.</span><span class="nx">placeholder</span><span class="p">);</span>
                <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>And hide the autocomplete after a short while.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span> <span class="p">},</span>
                    <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">hideAfter</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="nx">click</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>Show the autocomplete when the user clicks on the input,
assuming it contains enought characters.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">minimumCharacters</span><span class="p">)</span>
                    <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">});</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>Bind mouse events to fire signals. Because the same signals will be
sent if the user uses keyboard to work with the autocomplete.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">autocompleteChoiceSelector</span><span class="p">).</span><span class="nx">live</span><span class="p">({</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>When the mouse enters a choice ...</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="nx">mouseenter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>... the first thing we want is to send the dehilight signal
for any hilighted choice ...</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nx">$</span><span class="p">(</span><span class="nx">autocomplete</span><span class="p">.</span><span class="nx">hilightedChoiceSelector</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;dehilightChoice&#39;</span><span class="p">,</span>
                        <span class="p">[</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">autocomplete</span><span class="p">]);</span>
                <span class="p">});</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>... and then sent the hilight signal for the choice.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;hilightChoice&#39;</span><span class="p">,</span>
                    <span class="p">[</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">autocomplete</span><span class="p">]);</span>
            <span class="p">},</span>
            <span class="nx">mouseleave</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>Send dehilightChoice when the mouse leaves a choice.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;dehilightChoice&#39;</span><span class="p">,</span>
                    <span class="p">[</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">autocomplete</span><span class="p">]);</span>
            <span class="p">},</span>
            <span class="nx">click</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>Send selectChoice when the user clicks on a choice.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
                <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
                <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;selectChoice&#39;</span><span class="p">,</span>
                    <span class="p">[</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">autocomplete</span><span class="p">]);</span>
            <span class="p">},</span>
        <span class="p">});</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>Bind keyup in the input to call this.refresh()</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">keyup</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span> <span class="p">});</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>Bind keyboard events to call this.keypress(), which handles keyboard
navigation.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">opera</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">keypress</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">keypress</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span> <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">keydown</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">keypress</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span> <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>This function is in charge of keyboard usage.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">keypress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">choice</span><span class="p">;</span>

        <span class="k">switch</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>KEY_ESC pressed hide the autocomplete.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">case</span> <span class="mi">27</span><span class="o">:</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p>KEY_RETURN or KEY_TAB pressed, trigger select-choice if a
choice is hilighted.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">case</span> <span class="mi">9</span><span class="o">:</span>
            <span class="k">case</span> <span class="mi">13</span><span class="o">:</span>
                <span class="nx">choice</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hilightedChoiceSelector</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">choice</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
                    <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;selectChoice&#39;</span><span class="p">,</span>
                        <span class="p">[</span><span class="nx">choice</span><span class="p">,</span> <span class="k">this</span><span class="p">]);</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">break</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>On KEY_UP, call move()</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">case</span> <span class="mi">38</span><span class="o">:</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>On KEY_DOWN, call move()</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">case</span> <span class="mi">40</span><span class="o">:</span> <span class="c1">//KEY_DOWN:</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>Ignore other keypresses.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">default</span><span class="o">:</span>
                <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>We handled our cases, prevent the browser from doing anything
unexpected.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">e</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">();</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>This function is in charge of ensuring that a relevant autocomplete is
shown.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>First recalculate the absolute position since the autocomplete may
have changed position.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">fixPosition</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p>If the inner container is empty and there is no current pending
request, rely on fetch(), which should show the
autocomplete as soon as it's done fetching.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">innerContainer</span><span class="p">.</span><span class="nx">html</span><span class="p">()).</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p>And actually, fetch() will call show() with the response
body as argument.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">innerContainer</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p>Show the inner and outer container only if necessary.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">innerContainer</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;:visible&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">outerContainer</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">innerContainer</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      <p>This function is in charge of the opposite.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">hide</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">outerContainer</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">innerContainer</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      <p>This function is in charge of hilighting the right result from keyboard
navigation.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">move</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">way</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <p>The current choice if any.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hilightedChoiceSelector</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>The first and last choices. If the user presses down on the last
choice, then the first one will be hilighted.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">first</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">autocompleteChoiceSelector</span> <span class="o">+</span> <span class="s1">&#39;:first&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">last</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">autocompleteChoiceSelector</span> <span class="o">+</span> <span class="s1">&#39;:last&#39;</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <p>The choice that should be hilighted after the move.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">target</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      <p>The autocomplete must be shown so that the user sees what choice
he is hilighting.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      <p>If a choice is currently hilighted:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">way</span> <span class="o">==</span> <span class="s1">&#39;up&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <p>The target choice becomes the first previous choice.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nx">target</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">prevAll</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">choiceSelector</span> <span class="o">+</span> <span class="s1">&#39;:first&#39;</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      <p>If none, then the last choice becomes the target.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">target</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">last</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-58'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-58'>#</a>
      </div>
      <p>The target choice becomes the first  next** choice.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nx">target</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">nextAll</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">choiceSelector</span> <span class="o">+</span> <span class="s1">&#39;:first&#39;</span><span class="p">);</span>

                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;new target&#39;</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-59'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-59'>#</a>
      </div>
      <p>If none, then the first choice becomes the target.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">target</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">first</span><span class="p">;</span>
            <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-60'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-60'>#</a>
      </div>
      <p>Trigger dehilightChoice on the currently hilighted choice.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;dehilightChoice&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="nx">current</span><span class="p">,</span> <span class="k">this</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">target</span> <span class="o">=</span> <span class="nx">way</span> <span class="o">==</span> <span class="s1">&#39;up&#39;</span> <span class="o">?</span> <span class="nx">last</span> <span class="o">:</span> <span class="nx">first</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-61'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-61'>#</a>
      </div>
      <p>Trigger hilightChoice on the target choice.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;hilightChoice&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="nx">target</span><span class="p">,</span> <span class="k">this</span><span class="p">]);</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-62'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-62'>#</a>
      </div>
      <p>Calculate and set the outer container's absolute positionning.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">fixPosition</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">css</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">offset</span><span class="p">()[</span><span class="s1">&#39;top&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">offset</span><span class="p">()[</span><span class="s1">&#39;left&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;position&#39;</span><span class="o">:</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="nx">css</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">());</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">outerContainer</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">css</span><span class="p">);</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-63'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-63'>#</a>
      </div>
      <p>Proxy fetch(), with some sanity checks.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">newValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-64'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-64'>#</a>
      </div>
      <p>If the input contains the placehold then abort.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">placeholder</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-65'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-65'>#</a>
      </div>
      <p>If the input doesn't contain enought characters then abort.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">minimumCharacters</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-66'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-66'>#</a>
      </div>
      <p>If the input hasn't changed value then abort.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-67'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-67'>#</a>
      </div>
      <p>Set the new current value.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-68'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-68'>#</a>
      </div>
      <p>All clear, continue on refreshing the autocomplete.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-69'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-69'>#</a>
      </div>
      <p>Manage requests to this.url.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">fetch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-70'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-70'>#</a>
      </div>
      <p>Abort any current request.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">xhr</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-71'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-71'>#</a>
      </div>
      <p>Again we need this from another scope.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">autocomplete</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-72'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-72'>#</a>
      </div>
      <p>Add the current value to the data dict.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">queryVariable</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-73'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-73'>#</a>
      </div>
      <p>Make an asynchronous GET request to this.url.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">xhr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">data</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
            <span class="nx">complete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">jqXHR</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-74'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-74'>#</a>
      </div>
      <p>Update and show the autocomplete.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">jqXHR</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-75'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-75'>#</a>
      </div>
      <p>Clear the current request keeper.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">xhr</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">},</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-76'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-76'>#</a>
      </div>
      <p>The jQuery plugin that manages Autocomplete instances across the various
inputs. It is named 'yourlabsAutocomplete' rather than just 'autocomplete'
to live happily with other plugins that may define an autocomplete() jQuery
plugin.</p>
<p>It takes an array as argument, the array may contain any attribute or
function that should override the Autocomplete builtin. For example:</p>
<p>$('input#your-autocomplete').yourlabsAutocomplete({
      url: '/some/url/',
      hide: function() {
          this.outerContainer
      },
  })</p>
<p>Also, it implements a simple identity map, which means that:</p>
<p>// First call for an input instanciates the Autocomplete instance
  $('input#your-autocomplete').yourlabsAutocomplete({
      url: '/some/url/',
  });</p>
<p>// Other calls return the previously created Autocomplete instance
  $('input#your-autocomplete').yourlabsAutocomplete().data = {
      newData: $('#foo').val(),
  }</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">yourlabsAutocomplete</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">overrides</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">overrides</span> <span class="o">=</span> <span class="nx">overrides</span> <span class="o">?</span> <span class="nx">overrides</span> <span class="o">:</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">overrides</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Autocomplete must have an id !&#39;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-77'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-77'>#</a>
      </div>
      <p>Disable the browser's autocomplete features on that input.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;autocomplete&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">yourlabsAutocomplete</span><span class="p">.</span><span class="nx">registry</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-78'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-78'>#</a>
      </div>
      <p>Instanciate a registry for {id: Autocomplete instance}</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">yourlabsAutocomplete</span><span class="p">.</span><span class="nx">registry</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-79'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-79'>#</a>
      </div>
      <p>If no Autocomplete instance is defined for this id, make one.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">yourlabsAutocomplete</span><span class="p">.</span><span class="nx">registry</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">overrides</span><span class="p">.</span><span class="nx">url</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Autocomplete needs a url !&#39;</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-80'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-80'>#</a>
      </div>
      <p>Instanciate Autocomplete.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">yourlabsAutocomplete</span><span class="p">.</span><span class="nx">registry</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">yourlabs</span><span class="p">.</span><span class="nx">Autocomplete</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-81'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-81'>#</a>
      </div>
      <p>Extend the instance with overrides.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">yourlabsAutocomplete</span><span class="p">.</span><span class="nx">registry</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">yourlabsAutocomplete</span><span class="p">.</span><span class="nx">registry</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="nx">overrides</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-82'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-82'>#</a>
      </div>
      <p>All set, call initialize().</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">yourlabsAutocomplete</span><span class="p">.</span><span class="nx">registry</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">initialize</span><span class="p">();</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-83'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-83'>#</a>
      </div>
      <p>Return the Autocomplete instance for this id from the registry.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">yourlabsAutocomplete</span><span class="p">.</span><span class="nx">registry</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
<span class="p">};</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-84'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-84'>#</a>
      </div>
      <p>Serves as both an example to set a signal, and to set or unset the hilight class.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;hilightChoice&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">choice</span><span class="p">,</span> <span class="nx">autocomplete</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">choice</span><span class="p">,</span> <span class="nx">autocomplete</span><span class="p">.</span><span class="nx">hilightClass</span><span class="p">)</span>
        <span class="nx">choice</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">autocomplete</span><span class="p">.</span><span class="nx">hilightClass</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;dehilightChoice&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">choice</span><span class="p">,</span> <span class="nx">autocomplete</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">choice</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">autocomplete</span><span class="p">.</span><span class="nx">hilightClass</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
